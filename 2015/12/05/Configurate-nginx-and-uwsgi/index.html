<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="This is a blog record technical things."/><title>配置Nginx和uWSGI搭建Django运行环境 | TNK</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">配置Nginx和uWSGI搭建Django运行环境</h1><a id="logo" href="/">TNK</a><p class="description">Ruter's blog</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/MyWiki/"><i class="icon-guestbook"> Wiki</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">配置Nginx和uWSGI搭建Django运行环境</h1><div class="post-meta">2015-12-05 | <span class="categories">分类于<a href="/categories/Server/"> Server</a></span></div><span data-disqus-identifier="2015/12/05/Configurate-nginx-and-uwsgi/" class="disqus-comment-count"></span><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#更新和安装需要的包"><span class="toc-number">1.</span> <span class="toc-text">更新和安装需要的包</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装PCRE"><span class="toc-number">1.1.</span> <span class="toc-text">安装PCRE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Nginx"><span class="toc-number">1.2.</span> <span class="toc-text">安装Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装uWSGI"><span class="toc-number">1.3.</span> <span class="toc-text">安装uWSGI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Django"><span class="toc-number">1.4.</span> <span class="toc-text">安装Django</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置"><span class="toc-number">2.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置uWSGI"><span class="toc-number">2.1.</span> <span class="toc-text">配置uWSGI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置Nginx"><span class="toc-number">2.2.</span> <span class="toc-text">配置Nginx</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#启动测试"><span class="toc-number">3.</span> <span class="toc-text">启动测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开启Nginx"><span class="toc-number">3.1.</span> <span class="toc-text">开启Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开启uWSGI"><span class="toc-number">3.2.</span> <span class="toc-text">开启uWSGI</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多参考文档"><span class="toc-number">4.</span> <span class="toc-text">更多参考文档</span></a></li></ol></div></div><div class="post-content"><p>不久前试用了阿里云的ECS，用来试着部署之前用<code>Django</code>写的一个博客，遇到了不少问题啊TvT在Google上搜出来的方法都是旧的没法解决问题呢，所以就摸索着弄，最后不得不说，官方文档才是人类的好基友啊(缺胳膊少腿的我们暂时忽略掉吧)！</p>
<h1 id="更新和安装需要的包"><a href="#更新和安装需要的包" class="headerlink" title="更新和安装需要的包"></a>更新和安装需要的包</h1><p>我使用的系统是64位的CentOS 6.5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y update</div><div class="line">yum install -y epel-release sqlite-devel zlib-devel.x86_64 openssl-devel.x86_64 python-devel</div></pre></td></tr></table></figure>
<h2 id="安装PCRE"><a href="#安装PCRE" class="headerlink" title="安装PCRE"></a>安装PCRE</h2><p>下载并解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.37.tar.gz</div><div class="line">tar zxvf pcre-8.37.tar.gz</div></pre></td></tr></table></figure></p>
<p>编译安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd pcre-8.37</div><div class="line">./configure</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure></p>
<p>安装完成后可以查看版本号<code>pcre-config --version</code></p>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><p>我这里用的是1.8.0 stable 版本，先下载然后解压进目录进行配置编译安装，这里直接给出命令不再详述<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://nginx.org/download/nginx-1.8.0.tar.gz</div><div class="line">tar nginx-1.8.0.tar.gz</div><div class="line">cd nginx-1.8.0</div><div class="line">./configure --prefix=/usr/local/nginx</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure></p>
<h2 id="安装uWSGI"><a href="#安装uWSGI" class="headerlink" title="安装uWSGI"></a>安装uWSGI</h2><p>在上一篇升级Python的博客里已经顺便安装好了pip，现在派上用场了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install uwsgi</div></pre></td></tr></table></figure></p>
<h2 id="安装Django"><a href="#安装Django" class="headerlink" title="安装Django"></a>安装Django</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install django</div></pre></td></tr></table></figure>
<p>到这里我们已经把需要安装的东西都准备好了，现在开始进行配置</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="配置uWSGI"><a href="#配置uWSGI" class="headerlink" title="配置uWSGI"></a>配置uWSGI</h2><p>假设我们已经有一个Django的项目叫<code>blog</code>，路径是<code>/var/www/blog/</code>，现在进入这个项目的目录下，新建一个<code>blog.ini</code>文件，添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[uwsgi]</div><div class="line">uid = www</div><div class="line">gid = www</div><div class="line"></div><div class="line">chdir = /var/www/blog</div><div class="line">module = blog.wsgi</div><div class="line"></div><div class="line">master = true</div><div class="line">processes = 10</div><div class="line"></div><div class="line">socket = /tmp/blog.sock</div><div class="line">chmod-socket = 664</div><div class="line"></div><div class="line">vacuum = true</div><div class="line"></div><div class="line">daemonize = /var/www/blog/blog.log</div></pre></td></tr></table></figure></p>
<h2 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h2><p>创建 Nginx 运行使用的用户 www：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/usr/sbin/groupadd www</div><div class="line">/usr/sbin/useradd -g www www</div></pre></td></tr></table></figure></p>
<p>编辑Nginx的配置文件<code>nginx.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /usr/local/nginx/conf/nginx.conf</div></pre></td></tr></table></figure></p>
<p>将第一行的<code>#user  nobody;</code> 改成 <code>user    www www;</code><br>然后找到下面这两行，去掉注释<code>#</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#error_log  logs/error.log;</div><div class="line">#pid        logs/nginx.pid;</div></pre></td></tr></table></figure></p>
<p>然后在<code>http {}</code>块内的最下面添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">upstream blog &#123;</div><div class="line">  server unix:///tmp/blog.sock;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">  listen 8000;</div><div class="line">  server_name .example.com;</div><div class="line"></div><div class="line">  charset utf-8;</div><div class="line"></div><div class="line">  client_max_body_size 75M;</div><div class="line"></div><div class="line">  location /media &#123;</div><div class="line">  	alias /var/www/blog/media;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  location /static &#123;</div><div class="line">  	alias /var/www/blog/static;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  location / &#123;</div><div class="line">    uwsgi_pass blog;</div><div class="line">    include uwsgi_params;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>噔噔！我们已经完成了Nginx的基础配置了，想要了解更多Nginx的具体配置请参考官方提供的<a href="https://www.nginx.com/resources/wiki/start/topics/examples/full/" target="_blank" rel="external">完整配置示例</a></p>
<h1 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h1><h2 id="开启Nginx"><a href="#开启Nginx" class="headerlink" title="开启Nginx"></a>开启Nginx</h2><p>在启动Nginx之前先对配置文件的语法进行检查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx -t</div></pre></td></tr></table></figure></p>
<p>确认无误后启动Nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx</div></pre></td></tr></table></figure></p>
<p>这时可能会出现如下的错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx: [error] open() &quot;/usr/local/nginx/logs/nginx.pid&quot; failed (2: No such file or directory)</div></pre></td></tr></table></figure></p>
<p>只需要执行以下这条命令就可以解决问题了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</div></pre></td></tr></table></figure></p>
<p>Nginx的常用命令有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx -s reload|reopen|stop</div></pre></td></tr></table></figure></p>
<p>分别是重新读取配置文件，重新启动以及停止</p>
<h2 id="开启uWSGI"><a href="#开启uWSGI" class="headerlink" title="开启uWSGI"></a>开启uWSGI</h2><p>启动Nginx（请参考前面）之后，我们再来启动uWSGI<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">uwsgi --ini /var/www/blog/blog.ini</div></pre></td></tr></table></figure></p>
<p>开启成功之后就可以访问Nginx配置里<code>server_name</code>所对应的ip或域名进行访问了，如这里的配置示例，我们访问<a href="http://example.com:8000" target="_blank" rel="external">http://example.com:8000</a>就可以看到创建好的blog啦！</p>
<h1 id="更多参考文档"><a href="#更多参考文档" class="headerlink" title="更多参考文档"></a>更多参考文档</h1><p><a href="https://www.nginx.com/resources/wiki/start/topics/examples/fullexample2/" target="_blank" rel="external">Another nginx.conf Full Example</a><br><a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html#configure-nginx-for-your-site" target="_blank" rel="external">Setting up Django and your web server with uWSGI and nginx</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-uwsgi-and-nginx-on-ubuntu-14-04" target="_blank" rel="external">How To Serve Django Applications with uWSGI and Nginx on Ubuntu 14.04</a></p>
</div><div class="tags"><a href="/tags/Server/">Server</a><a href="/tags/Nginx/">Nginx</a><a href="/tags/uWSGI/">uWSGI</a></div><div class="post-nav"><a href="/2015/12/13/Create-blog-with-hexo/" class="pre"><i class="icon-previous">用Hexo创建博客</i></a><a href="/2015/12/03/Update-python/" class="next">CentOS升级Python2.6到Python2.7并安装pip<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'ruter-tnk';
var disqus_identifier = '2015/12/05/Configurate-nginx-and-uwsgi/';
var disqus_title = '配置Nginx和uWSGI搭建Django运行环境';
var disqus_url = 'http://blog.ruterly.com/2015/12/05/Configurate-nginx-and-uwsgi/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ruter-tnk.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div id="search"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://blog.ruterly.com"></form></div></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">Server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/">Tutorial</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/Server/">Server</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/WeApp/" style="font-size: 15px;">WeApp</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/VFL/" style="font-size: 15px;">VFL</a> <a href="/tags/Auto-Layout/" style="font-size: 15px;">Auto Layout</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Server/" style="font-size: 15px;">Server</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/uWSGI/" style="font-size: 15px;">uWSGI</a> <a href="/tags/GitHub-Pages/" style="font-size: 15px;">GitHub Pages</a> <a href="/tags/Wechat/" style="font-size: 15px;">Wechat</a> <a href="/tags/Shadowsocks/" style="font-size: 15px;">Shadowsocks</a> <a href="/tags/Shadowrocket/" style="font-size: 15px;">Shadowrocket</a> <a href="/tags/Syncthing/" style="font-size: 15px;">Syncthing</a> <a href="/tags/Cloud/" style="font-size: 15px;">Cloud</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/PC/" style="font-size: 15px;">PC</a> <a href="/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Typora/" style="font-size: 15px;">Typora</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/10/Typora/">「玩物志」精美而强大的Markdown编辑器 - Typora</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/14/Create-a-WeApp/">微信小程序开发尝鲜</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/07/How-to-use-Shadowrocket/">「玩物志」Shadowrocket的使用及配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/How-to-Use-Syncthing/">「玩物志」Syncthing的安装与使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/21/An-introduction-to-VFL/">初识Auto Layout的VFL</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/Setting-Ubuntu-backlight/">笔记本安装Ubuntu后背光亮度的调节</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/19/GitHub-Pages-Site/">将博客部署到GitHub Pages上</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/05/Phoenix-OS-Experience/">「玩物志」Phoenix OS初体验--有待提高的OS新秀</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/13/Create-blog-with-hexo/">用Hexo创建博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/05/Configurate-nginx-and-uwsgi/">配置Nginx和uWSGI搭建Django运行环境</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//ruter-tnk.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://www.sunnyrx.com/" title="SunnyRx's Blog" target="_blank">SunnyRx's Blog</a><ul></ul><a href="http://talesofwing.github.io/" title="Zero's Blog" target="_blank">Zero's Blog</a><ul></ul><a href="http://elfgzp.cn" title="Gzp's Blog" target="_blank">Gzp's Blog</a><ul></ul><a href="http://www.jianshu.com/users/148cab15306f/latest_articles" title="妖孽的简书" target="_blank">妖孽的简书</a></div></div></div></div><div id="footer">© 2015 <a href="/" rel="nofollow">TNK</a> by<a rel="nofollow" target="_blank" href="https://github.com/ruter"> Ruter.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js"></script>
<script src="/js/totop.js"></script><script src="/js/fancybox.pack.js"></script>
<script src="/js/jquery.fancybox.js"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"></div></body></html>